<script>
	(function () {
		'use strict';

		var checklist = document.querySelector('[data-design-checklist]');

		var forEachSupport = ('forEach' in Array.prototype);
		var hasQuerySelectorSupport = ('querySelector' in document && 'querySelectorAll' in document);
		var hasClassListSupport = ('classList' in document.documentElement);
		var hasHiddenSupport = ("hidden" in document.createElement('div'));

		// check for localStorage support. Due to a bug in older versions of Firefox, this test will raise an exception
		// if cookies are disabled, so the entire test is wrapped in a try..catch statement.
		// http://diveintohtml5.info/detect.html#storage
		function supportsLocalStorage() {
			try {
				return 'localStorage' in window && window['localStorage'] !== null;
			} catch (e) {
				return false;
			}
		}

		//only enhance if the following feautures are supported
		if (forEachSupport &&
			hasQuerySelectorSupport &&
			hasClassListSupport &&
			supportsLocalStorage &&
			hasHiddenSupport) {
			initEnhancedChecklist();
		}

		function initEnhancedChecklist() {
			var VISIBLE_CLASS = 'is-visible';
			var groups = listNodes(document, '[data-checkbox-group]');
			var checkboxes = listNodes(document, '[data-checkbox]');
			var inputs = listNodes(document, 'input');
			var expandibles = listNodes(document, '[data-expandible]');
			var clearHandle = document.querySelector('[data-clear-handle]');
			var persistentCheckboxesInfo = document.querySelector('[data-persistent-checkboxes]')

			persistentCheckboxesInfo.classList.add(VISIBLE_CLASS);
			clearHandle.classList.add(VISIBLE_CLASS);

			groups.forEach(function (group) {
				group.addEventListener('click', function (event) {
					var collectiveInput = group.querySelector('[data-collective-input]');
					var individualInputs = listNodes(group, '[data-individual-input]');
					var targetIsCheckbox = event.target.type === 'checkbox';
					var targetIsCollective = event.target.hasAttribute('data-collective-input');
					var targetIsIndividual = event.target.hasAttribute('data-individual-input');

					if (event.target && targetIsCheckbox) {

						if (targetIsCollective) {
							individualInputs.forEach(function (individualInput) {
								setCheckboxState(individualInput, collectiveInput.checked);
								addToLocalStorage(individualInput);
							});
						}
						if (targetIsIndividual) {
							var allChecked = individualInputs.every(function (element) {
								return element.checked;
							});

							if (allChecked) {
								setCheckboxState(collectiveInput, true);
							} else {
								setCheckboxState(collectiveInput, false);
							}
							addToLocalStorage(collectiveInput);
						}
					}
				});
			});

			inputs.forEach(function (input) {
				if (localStorage.getItem(input.id) === "true") {
					setCheckboxState(input, true);
				}

				input.addEventListener('change', function(e) {
					addToLocalStorage(input);
				});
			});

			clearHandle.addEventListener('click', function() {
				localStorage.clear();
				inputs.forEach(function (input) {
					setCheckboxState(input, false);
				})
			})

			expandibles.forEach(function (expandible) {
				var expandibleHandle = expandible.querySelector('[data-expandible-handle]');
				var expandibleContent = expandible.querySelector('[data-expandible-content]');

				expandible.className += (' is-expandible-item');
				expandibleContent.setAttribute('hidden', '');

				expandibleHandle.addEventListener('click', function() {
					toggleHidden(expandibleContent);
				})
			});
		}

		function toggleHidden(element) {
			element.hasAttribute('hidden') ? element.removeAttribute('hidden') : element.setAttribute('hidden', '');
		}

		function setCheckboxState(input, state) {
			input.checked = state;
		};

		function addToLocalStorage(input) {
			localStorage.setItem(input.id, JSON.stringify(input.checked));
		};

		/**
		 * Convert node list to array
		 */
		function listNodes(context, selector) {
			return Array.prototype.slice.call(context.querySelectorAll(selector));
		}

	}());
</script>

<style>

	.enhanced-content {
		display: none;
	}

	.enhanced-content.is-visible {
		display: block;
	}

	.clear-button {
		float: right;
		padding: 0;
		background: transparent;
		border-bottom: 1px solid;
		font-family: sans-serif;
		outline: none;
		-webkit-transition: color 250ms ease;
		transition: color 250ms ease;
	}

	.fonts-loaded .clear-button {
		font-family: Noto, Georgia, serif;
	}

	.clear-button:hover,
	.clear-button:focus {
		color: #0cafcd;
		border-bottom: 1px solid;
	}

	.rich-text .checklist,
	.checklist {
		clear: right;
    padding: 0;
    list-style: none;
	}

	.blog-post .page-content .checklist,
	.blog-post .page-content .checklist ul,
	.blog-post .page-content .encore-list {
		list-style: none;
		padding-left: 0;
	}

  .checklist[data-checklist] li::before,
  .checklist[data-checklist] li li::before {
    content: none;
  }

	.blog-post .page-content .checklist .bullet-list {
		list-style: disc;
		list-style-position: inside;
	}

	.checklist input[type="checkbox"] ~ .label-text {
		display: inline-block;
		padding-right: 1.5rem;
	}

	.checklist > li > .checkbox,
	.checklist .nested-list li {
		margin-bottom: 0.25rem;
		padding-bottom: 0.25rem;
	}

	.checklist > li > .checkbox {
		border-bottom: 4px solid #12353c;
	}

	.checklist .nested-list > li {
		border-bottom: 4px solid #d7ddde;
	}

	.is-expandible-item {
		position: relative;
	}

	.expandible-handle {
		display: none;
	}

	.expandible-handle-text {
		border: 0;
		clip: rect(0 0 0 0);
		height: 1px;
		margin: -1px;
		overflow: hidden;
		padding: 0;
		position: absolute;
		width: 1px;
	}

	.is-expandible-item .expandible-handle {
		display: block;
		position: absolute;
		top: 0.4rem;
		right: 0;
		height: 1em;
		width: 1em;
		padding: 0.25rem;
		border: 2px solid #12353C;
		border-radius: 50%;
		background-size: 75%;
		background-position: 50%;
		background-color: transparent;
		background-image: url('data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%20488.9%20488.9%22%3E%3Cpath%20fill%3D%27%230D5458%27%20d%3D%22M239.2%200c31.9%200%2057.7%2025.8%2057.7%2057.7s-25.8%2057.7-57.7%2057.7%20-57.7-25.8-57.7-57.7S207.3%200%20239.2%200zM291.7%20151.6h-1.5%20-92.8%20-3.4c-19%200-34.3%2015.4-34.3%2034.3l0%200c0%2019%2015.4%2034.3%2034.3%2034.3h3.4v200h-37.7v68.7h169.6v-68.7h-37.5V151.6H291.7z%22%2F%3E%3C%2Fsvg%3E');
		background-repeat: no-repeat;
		transition: border-color 250ms ease;
	}

	.is-expandible-item .expandible-handle:hover, .is-expandible-item .expandible-handle:focus {
		outline: none;
		border-color: #0CAFCD;
	}

	.expandible-content {
		margin-top: -0.25rem;
		margin-bottom: 0.25rem;
		padding: 0.5rem 1rem 1rem;
		background-color: #f3f5f6;
	}

	.nested-list .expandible-content {
		margin-top: 0.25rem;
		margin-bottom: -0.5rem;
		border-top: 4px solid #d7ddde;
	}

	.pro,
	.con {
		display: inline-block;
		height: 1em;
		width: 1em;
		margin-right: 0.5em;
		vertical-align: middle;
	}

	.pro {
		background-image: url('data:image/svg+xml,%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22utf-8%22%3F%3E%0D%0A%3C%21--%20Generator%3A%20Adobe%20Illustrator%2018.1.1%2C%20SVG%20Export%20Plug-In%20.%20SVG%20Version%3A%206.00%20Build%200%29%20%20--%3E%0D%0A%3C%21DOCTYPE%20svg%20PUBLIC%20%22-%2F%2FW3C%2F%2FDTD%20SVG%201.1%2F%2FEN%22%20%22http%3A%2F%2Fwww.w3.org%2FGraphics%2FSVG%2F1.1%2FDTD%2Fsvg11.dtd%22%3E%0D%0A%3Csvg%20version%3D%221.1%22%20id%3D%22Layer_1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20xmlns%3Axlink%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxlink%22%20x%3D%220px%22%20y%3D%220px%22%0D%0A%09%20viewBox%3D%220%200%2017.3%2018.2%22%20enable-background%3D%22new%200%200%2017.3%2018.2%22%20xml%3Aspace%3D%22preserve%22%3E%0D%0A%3Cg%3E%0D%0A%09%3Crect%20x%3D%221.1%22%20y%3D%226.7%22%20fill%3D%22%2342B200%22%20width%3D%223.9%22%20height%3D%228.1%22%2F%3E%0D%0A%09%3Cpath%20fill%3D%22%2342B200%22%20d%3D%22M14.8%2C6.2c-1%2C0-2.2%2C0-2.2%2C0c0-1%2C0-3-0.1-3.9C12.2%2C1%2C11.7%2C1%2C11.2%2C1c-1%2C0-1%2C1.3-1.5%2C3.2%0D%0A%09%09C9.3%2C6%2C7.2%2C7.3%2C5.9%2C7.5v6.3c1%2C0%2C1.4%2C0%2C2.4%2C0s0.5%2C1%2C1.4%2C1c1%2C0%2C1.9%2C0%2C4.3%2C0c2.4%2C0%2C2.4-2.4%2C2.4-2.4s0-3.6%2C0-4.6%0D%0A%09%09C16.3%2C6.8%2C15.7%2C6.2%2C14.8%2C6.2z%22%2F%3E%0D%0A%3C%2Fg%3E%0D%0A%3C%2Fsvg%3E%0D%0A');
	}

	.con {
		background-image: url('data:image/svg+xml,%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22utf-8%22%3F%3E%0D%0A%3C%21--%20Generator%3A%20Adobe%20Illustrator%2018.1.1%2C%20SVG%20Export%20Plug-In%20.%20SVG%20Version%3A%206.00%20Build%200%29%20%20--%3E%0D%0A%3C%21DOCTYPE%20svg%20PUBLIC%20%22-%2F%2FW3C%2F%2FDTD%20SVG%201.1%2F%2FEN%22%20%22http%3A%2F%2Fwww.w3.org%2FGraphics%2FSVG%2F1.1%2FDTD%2Fsvg11.dtd%22%3E%0D%0A%3Csvg%20version%3D%221.1%22%20id%3D%22Layer_1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20xmlns%3Axlink%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxlink%22%20x%3D%220px%22%20y%3D%220px%22%0D%0A%09%20viewBox%3D%220%200%2017.3%2018.2%22%20enable-background%3D%22new%200%200%2017.3%2018.2%22%20xml%3Aspace%3D%22preserve%22%3E%0D%0A%3Cg%3E%0D%0A%09%3Crect%20x%3D%221.1%22%20y%3D%221%22%20fill%3D%22%23E45E44%22%20width%3D%223.9%22%20height%3D%228.1%22%2F%3E%0D%0A%09%3Cpath%20fill%3D%22%23E45E44%22%20d%3D%22M16.3%2C8c0-0.9%2C0-4.6%2C0-4.6s0-2.4-2.4-2.4c-2.4%2C0-3.3%2C0-4.3%2C0c-1%2C0-0.5%2C1-1.4%2C1S6.8%2C2%2C5.8%2C2v6.3%0D%0A%09%09c1.3%2C0.3%2C3.4%2C1.6%2C3.8%2C3.3c0.5%2C1.9%2C0.6%2C3.2%2C1.5%2C3.2c0.6%2C0%2C1%2C0%2C1.2-1.3c0.2-0.9%2C0.1-2.9%2C0.1-3.9c0%2C0%2C1.3%2C0%2C2.2%2C0%0D%0A%09%09C15.6%2C9.6%2C16.3%2C8.9%2C16.3%2C8z%22%2F%3E%0D%0A%3C%2Fg%3E%0D%0A%3C%2Fsvg%3E%0D%0A');
	}

	@media print {
		.checklist figure,
		.enhanced-content.is-visible {
			display: none;
		}

		.checklist [hidden] {
			display: block;
		}

		.checklist a[href^=http]:after {
			content:" <" attr(href) "> ";
			font-size: 0.9rem;
		}
	}

</style>
